<html><head><link rel="import" href="../bower_components/polymer/polymer.html"></head><body><dom-module id="news-data"><script>(function(){var b=document.createElement('textarea');Polymer({is:'news-data',properties:{categories:{type:Array,value:[{name:'top_stories',title:'Top Stories'},{name:'doodles',title:'Doodles'},{name:'chrome',title:'Chrome'},{name:'search',title:'Search'},{name:'shopping_payments',title:'Shopping & Payments'},{name:'nonprofits',title:'Nonprofits'}],readOnly:!0,notify:!0},categoryName:String,articleId:String,offline:Boolean,loading:{type:Boolean,readOnly:!0,notify:!0},category:{type:Object,computed:'_computeCategory(categoryName)',notify:!0},article:{type:Object,computed:'_computeArticle(category.items, articleId)',notify:!0},failure:{type:Boolean,readOnly:!0,notify:!0}},observers:['_fetchCategory(category, offline)','_fetchArticle(article, offline)'],_computeArticle:function(d,f){for(var h,g=0;g<d.length;++g)if(h=d[g],h.id===f)return h;return null},_fetchArticle:function(d,f){return f&&d&&d.html||!d||this.loading?void this._setFailure(!1):void this._fetch('data/articles/'+d.id+'.html',function(g){this.set('article.html',this._formatHTML(g))}.bind(this),1,!0)},_computeCategory:function(d){for(var g,f=0;g=this.categories[f];++f)if(g.name===d)return g;return null},_fetchCategory:function(d,f,g){return f&&d&&d.items||!d||this.loading?void this._setFailure(!1):void this._fetch('/tests/polymer/data/'+d.name+'.json',function(h){this.set('category.items',this._parseCategoryItems(h))}.bind(this),g||1)},_parseCategoryItems:function(d){for(var h,f=[],g=0;h=d[g];++g)f.push({headline:this._unescapeText(h.title),href:this._getItemHref(h),id:h.id,imageUrl:this._getItemImage(h),placeholder:h.placeholder,category:h.category,timeAgo:this._timeAgo(new Date(h.time).getTime()),author:h.author,summary:this._trimRight(h.summary,100),readTime:Math.max(2,Math.round(h.contentLength/3e3))+' min read'});return f},_unescapeText:function(d){return b.innerHTML=d,b.textContent},_getItemHref:function(d){return d.id?'/article/'+this.categoryName+'/'+encodeURIComponent(d.id):null},_getItemImage:function(d){return d.imgSrc?'data/'+d.imgSrc:''},_timeAgo:function(d){if(!d)return'';var f=(Date.now()-d)/1e3/60;if(2>f)return'1 min ago';if(60>f)return Math.floor(f)+' mins ago';if(120>f)return'1 hour ago';var g=f/60;return 24>g?Math.floor(g)+' hours ago':48>g?'1 day ago':Math.floor(g/24)+' days ago'},_trimRight:function(d,f){var g=d.indexOf(' ',f);return-1===g?d:d.substr(0,g)+'...'},_formatHTML:function(d){var f=document.createElement('template');f.innerHTML=d;for(var j,g=f.content.querySelectorAll('img'),h=0;h<g.length;++h)j=g[h],j.removeAttribute('width'),j.removeAttribute('height');return f.content.querySelector('.content').innerHTML},_fetch:function(d,f,g,h){var j=new XMLHttpRequest;j.addEventListener('load',function(k){this._setLoading(!1),h?f(k.target.responseText):f(JSON.parse(k.target.responseText))}.bind(this)),j.addEventListener('error',function(){1<g?this.debounce('_fetch',this._fetch.bind(this,d,f,g-1),200):(this._setLoading(!1),this._setFailure(!0))}.bind(this)),this._setLoading(!0),this._setFailure(!1),j.open('GET',d),j.send()},refresh:function(){this.categoryName&&this._fetchCategory(this.category,this.offline,3)}})})();</script></dom-module></body></html>